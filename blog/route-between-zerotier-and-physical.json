{
    "slug": "route-between-zerotier-and-physical",
    "title": "Route between ZeroTier and Physical Networks ,ZeroTier as VPN",
    "excerpt": "Route betweenZeroTier and Physical NetworksThis seems to be the simplest pattern for getting remote access to your LAN.It doesn't require access to the LAN's router or have some...",
    "content": "<h1></p><p></h1><img height=\"274\" src=\"https://nsheth.in/wp-content/uploads/2023/11/01-networks-empty-228c188bdb5b8c0689afd87579845639.png\" width=\"640\" loading=\"lazy\"><br><h1>Route between<br>ZeroTier and Physical Networks<o:p></o:p></h1><p>This seems to be the simplest pattern for getting remote access to your LAN.<br>It doesn't require access to the LAN's router or have some of the pitfalls of<br>bridging. This requires a Linux PC or VM, something that runs iptables, on your<br>LAN. A raspberrypi works. This is a <a href=\"https://en.wikipedia.org/wiki/Network_address_translation\">NAT/Masquerade</a><br>setup.<o:p></o:p></p><p>If you have a router that can run zerotier, you should use that instead of<br>this article. Many router vendors and operating systems have zerotier packages.<br><o:p></o:p></p><p>Possible Disadvantages:<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->No broadcast/multicast across networks (but the<br>mobile OS's don't allow this anyways).<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->Can't initiate connections <em>from</em> the LAN<br><em>to</em> an external ZeroTier client.<o:p></o:p></p><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-Summary\">Summary<o:p></o:p></h3><p><!--[if !supportLists]-->· <br><!--[endif]-->Install ZeroTier<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->Add a managed route to the ZeroTier network (at <a href=\"http://my.zerotier.com/\">my.zerotier.com</a>)<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->Enable IP Forwarding<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->Configure iptables<o:p></o:p></p><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-Requiredinformation\">Required information<o:p></o:p></h3><p>For Example:<o:p></o:p></p><table cellpadding=\"0\" cellspacing=\"0\"><br><tbody><tr><br><td><br><p align=\"center\"><b>Info<o:p></o:p></b></p><br></td><br><td><br><p align=\"center\"><b>Example<o:p></o:p></b></p><br></td><br><td><br><p align=\"center\"><b>Shorthand Name Below<o:p></o:p></b></p><br></td><br></tr><br><tr><br><td><br><p>ZeroTier Network ID<o:p></o:p></p><br></td><br><td><br><p>d5e04297a19bbd70<o:p></o:p></p><br></td><br><td><br><p>$NETWORK_ID<o:p></o:p></p><br></td><br></tr><br><tr><br><td><br><p>ZeroTier Interface Name<o:p></o:p></p><br></td><br><td><br><p>zt7nnig26<o:p></o:p></p><br></td><br><td><br><p>$ZT_IFACE<o:p></o:p></p><br></td><br></tr><br><tr><br><td><br><p>Physical Interface Name<o:p></o:p></p><br></td><br><td><br><p>eth0<o:p></o:p></p><br></td><br><td><br><p>$PHY_IFACE<o:p></o:p></p><br></td><br></tr><br><tr><br><td><br><p>ZeroTier subnet<o:p></o:p></p><br></td><br><td><br><p>172.27.0.0/16<o:p></o:p></p><br></td><br><td><br><p> <o:p></o:p></p><br></td><br></tr><br><tr><br><td><br><p>Physical subnet<o:p></o:p></p><br></td><br><td><br><p>192.168.100.0/24<o:p></o:p></p><br></td><br><td><br><p>$PHY_SUB<o:p></o:p></p><br></td><br></tr><br><tr><br><td><br><p>ZeroTier IP Address of \"Router\"<o:p></o:p></p><br></td><br><td><br><p>172.27.0.1<o:p></o:p></p><br></td><br><td><br><p>$ZT_ADDR<o:p></o:p></p><br></td><br></tr><br></tbody></table><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-InstallZeroTier\">Install ZeroTier<o:p></o:p></h3><p><a href=\"https://www.zerotier.com/download/\">https://www.zerotier.com/download/</a><o:p></o:p></p><pre>sudo zerotier-cli join $NETWORK_ID<o:p></o:p></pre><pre>sudo zerotier-cli listnetworks <o:p></o:p></pre><p>Authorize it at <a href=\"http://my.zerotier.com/network/$NETWORK_ID\">my.zerotier.com/network/$NETWORK_ID</a><o:p></o:p></p><p>The <em>listnetworks</em> output has the ZeroTier Interface name under<br>&lt;dev&gt;<o:p></o:p></p><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-ConfiguretheZeroTiermanagedroute\">Configure the ZeroTier<br>managed route<o:p></o:p></h3><p>At <a href=\"http://my.zerotier.com/network/$NETWORK_ID\">my.zerotier.com/network/$NETWORK_ID</a><br>-&gt; Settings -&gt; Managed Routes<o:p></o:p></p><p>This adds another route to every device joined to the ZeroTier network.<o:p></o:p></p><table cellpadding=\"0\" cellspacing=\"0\"><br><tbody><tr><br><td><br><p align=\"center\"><b>Destination<o:p></o:p></b></p><br></td><br><td><br><p align=\"center\"><b>(Via)<o:p></o:p></b></p><br></td><br></tr><br><tr><br><td><br><p>$PHY_SUB<o:p></o:p></p><br></td><br><td><br><p>$ZT_ADDR<o:p></o:p></p><br></td><br></tr><br></tbody></table><p>For example:<o:p></o:p></p><table cellpadding=\"0\" cellspacing=\"0\"><br><tbody><tr><br><td><br><p align=\"center\"><b>Destination<o:p></o:p></b></p><br></td><br><td><br><p align=\"center\"><b>(Via)<o:p></o:p></b></p><br></td><br></tr><br><tr><br><td><br><p>192.168.100.0/23<o:p></o:p></p><br></td><br><td><br><p>172.27.0.1<o:p></o:p></p><br></td><br></tr><br></tbody></table><p>Configure the destination route as slightly <strong>larger</strong> than the<br>actual physical subnet, here /23 instead of /24 (a smaller number is a bigger<br>subnet in this notation) This makes devices that are on both the physical and<br>the ZeroTier network prefer the physical connection.<o:p></o:p></p><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-EnableIPforwarding\">Enable IP forwarding<o:p></o:p></h3><p>This can vary depending on linux distribution. Typically:<o:p></o:p></p><p>Edit <strong>/etc/sysctl.conf</strong> to uncomment <strong>net.ipv4.ip_forward</strong>.<br>This enables forwarding at boot.<o:p></o:p></p><p>To enable it now<o:p></o:p></p><pre>sudo sysctl -w net.ipv4.ip_forward=1<o:p></o:p></pre><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-Configureiptables\">Configure iptables<o:p></o:p></h3><p>Assign some shell variables (personalize these)<o:p></o:p></p><pre>PHY_IFACE=eth0; ZT_IFACE=zt7nnig26<o:p></o:p></pre><p>Add rules to iptables<o:p></o:p></p><pre>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE<br>sudo iptables -A FORWARD -i eth0 -o zt6ovxldwb -m state --state RELATED,ESTABLISHED -j ACCEPT<br>sudo iptables -A FORWARD -i zt6ovxldwb -o eth0 -j ACCEPT</pre><pre>Save iptables rules for next boot</pre><p><o:p></o:p></p><pre>sudo apt install iptables-persistent<o:p></o:p></pre><pre>sudo bash -c iptables-save &gt; /etc/iptables/rules.v4<o:p></o:p></pre><h3 id=\"RoutebetweenZeroTierandPhysicalNetworks-Test!\">Test!<o:p></o:p></h3><p><!--[if !supportLists]-->· <br><!--[endif]-->Turn off wifi on your phone<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->Join it to the zerotier network, authorize it<o:p></o:p></p><p><!--[if !supportLists]-->· <br><!--[endif]-->Try to access something on the physical LAN<o:p></o:p></p>",
    "author": "Nityam Sheth",
    "date": "2023-11-04",
    "readTime": "3 min read",
    "category": "Networking",
    "tags": [
        "cybersecurity",
        "devops",
        "vnc"
    ],
    "image": "assets/blog/route-between-zerotier-and-physical-featured.png"
}